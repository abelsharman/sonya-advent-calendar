# üöÄ GitHub Actions - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

## ‚ùó –ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç–≤–æ–µ–≥–æ –ø—Ä–æ—à–ª–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### –ü—Ä–æ—à–ª—ã–π –ø—Ä–æ–µ–∫—Ç (AutosellBroker):
- ‚úÖ Node.js —Å–µ—Ä–≤–µ—Ä
- ‚úÖ PM2 –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ `npm run start-server`
- ‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ + build –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç (Advent Calendar):
- ‚úÖ **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç** (SPA)
- ‚ùå **PM2 –ù–ï –Ω—É–∂–µ–Ω**
- ‚úÖ **–¢–æ–ª—å–∫–æ nginx** –æ—Ç–¥–∞—ë—Ç —Ñ–∞–π–ª—ã
- ‚úÖ **Build –ª–æ–∫–∞–ª—å–Ω–æ** ‚Üí –∫–æ–ø–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

---

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

### –®–∞–≥ 1: –ü–µ—Ä–µ–π–¥–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```
GitHub ‚Üí –¢–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
```

### –®–∞–≥ 2: –î–æ–±–∞–≤—å —Å–ª–µ–¥—É—é—â–∏–µ secrets:

–ù–∞–∂–º–∏ **"New repository secret"** –∏ –¥–æ–±–∞–≤—å:

#### 1. `HOST`
```
–ó–Ω–∞—á–µ–Ω–∏–µ: IP –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
–ü—Ä–∏–º–µ—Ä: 123.45.67.89 –∏–ª–∏ server.example.com
```

#### 2. `USER`
```
–ó–Ω–∞—á–µ–Ω–∏–µ: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è SSH
–ü—Ä–∏–º–µ—Ä: root –∏–ª–∏ your_username
```

#### 3. `PASSWORD`
```
–ó–Ω–∞—á–µ–Ω–∏–µ: –ø–∞—Ä–æ–ª—å –æ—Ç SSH
‚ö†Ô∏è –í–∞–∂–Ω–æ: —Ö—Ä–∞–Ω–∏ –≤ —Å–µ–∫—Ä–µ—Ç–µ!
```

#### 4. `PORT`
```
–ó–Ω–∞—á–µ–Ω–∏–µ: –ø–æ—Ä—Ç SSH –¥–ª—è production
–ü—Ä–∏–º–µ—Ä: 22 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)
```

#### 5. `STAGING_PORT` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```
–ó–Ω–∞—á–µ–Ω–∏–µ: –ø–æ—Ä—Ç SSH –¥–ª—è staging
–ü—Ä–∏–º–µ—Ä: 22 –∏–ª–∏ –¥—Ä—É–≥–æ–π –µ—Å–ª–∏ staging –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workflows

–°–æ–∑–¥–∞–Ω—ã 2 workflow —Ñ–∞–π–ª–∞:

### 1. `.github/workflows/deploy.yml` 
**–î–µ–ø–ª–æ–π –Ω–∞ production**
- –¢—Ä–∏–≥–≥–µ—Ä: push –≤ `master` –∏–ª–∏ `main`
- –î–µ–ø–ª–æ–π –≤: `/var/www/advent-calendar`

### 2. `.github/workflows/deploy-staging.yml`
**–î–µ–ø–ª–æ–π –Ω–∞ staging**
- –¢—Ä–∏–≥–≥–µ—Ä: push –≤ `staging` –∏–ª–∏ `develop`
- –î–µ–ø–ª–æ–π –≤: `/var/www/advent-calendar-staging`

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ master/main:

1. **GitHub Actions –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
2. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Node.js 20**
3. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** (`npm ci`)
4. **–°–æ–±–∏—Ä–∞–µ—Ç production –±–∏–ª–¥** (`npm run build`)
5. **–ö–æ–ø–∏—Ä—É–µ—Ç –ø–∞–ø–∫—É `dist/` –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
6. **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   - –°–æ–∑–¥–∞—ë—Ç backup —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
   - –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç nginx
   - –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ backup'—ã

---

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Production –¥–µ–ø–ª–æ–π:
```bash
git add .
git commit -m "Update calendar"
git push origin master
```

### Staging –¥–µ–ø–ª–æ–π:
```bash
git checkout staging
git merge master
git push origin staging
```

---

## üîê –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: SSH –∫–ª—é—á–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–í–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª—è –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSH –∫–ª—é—á–∏:

### –ù–∞ —Ç–≤–æ—ë–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:
```bash
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º SSH –∫–ª—é—á (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
ssh-keygen -t ed25519 -C "github-actions"
# –°–æ—Ö—Ä–∞–Ω–∏ –≤: ~/.ssh/github_actions

# –ö–æ–ø–∏—Ä—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i ~/.ssh/github_actions.pub user@your-server
```

### –í GitHub Secrets:
–í–º–µ—Å—Ç–æ `PASSWORD` –¥–æ–±–∞–≤—å `SSH_KEY`:
```bash
# –°–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
cat ~/.ssh/github_actions
```

### –û–±–Ω–æ–≤–∏ workflow —Ñ–∞–π–ª—ã:
–ó–∞–º–µ–Ω–∏:
```yaml
password: ${{ secrets.PASSWORD }}
```

–ù–∞:
```yaml
key: ${{ secrets.SSH_KEY }}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π:
1. –ó–∞–ª–µ–π –∫–æ–¥ –≤ GitHub
2. –°–æ–∑–¥–∞–π secrets
3. –°–¥–µ–ª–∞–π push –≤ master
4. –ó–∞–π–¥–∏ –≤ **Actions** –Ω–∞ GitHub
5. –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –¥–µ–ø–ª–æ—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª—ã
ssh user@server
ls -la /var/www/advent-calendar
```

---

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "Permission denied"
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Å—å —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å sudo –ø—Ä–∞–≤–∞:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
sudo visudo
# –î–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É:
your_user ALL=(ALL) NOPASSWD: /usr/sbin/nginx, /bin/systemctl, /bin/chown, /bin/chmod, /bin/mv, /bin/rm
```

### –û—à–∏–±–∫–∞: "nginx: configuration file test failed"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx:
```bash
sudo nginx -t
```

### –û—à–∏–±–∫–∞: "npm ERR! ... NODE_ENV"
**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∏–≥–Ω–æ—Ä–∏—Ä—É–π. Build –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–æ–±–µ—Ä—ë—Ç—Å—è.

### Workflow –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** 
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ–∞–π–ª—ã –≤ `.github/workflows/`
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ secrets —Å–æ–∑–¥–∞–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤–µ—Ç–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `master` –∏–ª–∏ `main`

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ–µ–≤

### –í GitHub:
- –í–∫–ª–∞–¥–∫–∞ **Actions**
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–µ–ø–ª–æ–µ–≤
- –õ–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –õ–æ–≥–∏ nginx
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# –°–ø–∏—Å–æ–∫ backup'–æ–≤
ls -lh /var/www/ | grep advent-calendar-backup
```

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –°–æ–∑–¥–∞–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π git –ª–æ–∫–∞–ª—å–Ω–æ
git init
git add .
git commit -m "Initial commit"
git branch -M master
git remote add origin git@github.com:your-username/advent-calendar.git
git push -u origin master

# 3. –ù–∞—Å—Ç—Ä–æ–π secrets –≤ GitHub
# 4. –°–¥–µ–ª–∞–π –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏ push - –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è!
```

---

## üìù –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

‚ùå **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å Node.js** (—Ç–æ–ª—å–∫–æ nginx)  
‚ùå **–ó–∞–ø—É—Å–∫–∞—Ç—å npm install** (–≤—Å—ë —É–∂–µ —Å–æ–±—Ä–∞–Ω–æ)  
‚ùå **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å PM2** (—ç—Ç–æ —Å—Ç–∞—Ç–∏–∫–∞!)  
‚ùå **–ó–∞–ø—É—Å–∫–∞—Ç—å npm start** (nginx –≤—Å—ë –æ—Ç–¥–∞—ë—Ç)  

‚úÖ **–¢–æ–ª—å–∫–æ nginx** + **—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã** = **–ü—Ä–æ—Ñ–∏—Ç!** üéâ

---

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä! üöÄ

